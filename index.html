<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>CM MOVIES</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://kit.fontawesome.com/3daef5d92f.js" crossorigin="anonymous"></script>
        <!-- Mustache -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
        <!-- JQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>
    </head>
    <body>
        <header>
            <div class="container">
                <nav class="nav">
                    <a class="nav__item nav__home btn" href="index.html">Home</a>
                    <div class="search">
                        <select name="search__select" id="search__select">
                            <option value="All">All</option>
                            <option value="Movies">Movies</option>
                            <option value="Actors">Actors</option>
                        </select>
                        <input class="search__input" type="text">
                        <button class="search__btn btn">></button>
                    </div>
                    <p class="nav__item">Cameron McElwaney</p>
                </nav>
            </div>
        </header>
        <main>
            <div class="container results-container">
                <div class="result-options">
                    <div class="sort options-container">
                        <p class="sort__tag option__tag">Sort:</p>
                        <button class="sort__btn sort__alpha btn">A-Z</button>
                        <button class="sort__btn sort__price btn">$$>$</button>
                    </div>
                    <div class="display options-container">
                        <p class="display__tag option__tag">Display: </p>
                        <button class="display-btn display-grid-btn btn">GRID</button>
                        <button class="display-btn display-list-btn btn">LIST</button>
                    </div>
                </div>
                <div class="results">
                    <p class="no-search-alert">NO SEARCH PERFORMED</p>
                    <!-- Generated by mustache.js template on search button press -->
                </div>
            </div>
            <div class="more">
                <button class="more__btn btn">SHOW MORE</button>
            </div>  
        </main>
        <section class="detail">
            <div class="container detail__container">
                <div class="tag-container">
                    <p class="tag">DETAILS</p>
                </div>
                <!-- Generated using Mustache.js detail card template -->
            </div>
        </section>
        <footer>
            <div class="container">
                <div class="bookshelf">
                    <div class="tag-container">
                        <p class="tag">BOOKSHELF</p>
                    </div>
                    <div class="bookshelf__cards-container">
                        <!-- Generated via mustache template -->
                    </div>
                </div>
            </div>
            <div class="credit credit-container">
                <p>This product uses the TMDB API but is not endorsed or certified by TMDB.</p>
                <div class="credit__img-container">
                    <img src="tmdb_credit.svg" alt="">
                </div>
                <i class="fa-solid fa-circle-xmark"></i>
            </div>
            
        </footer>

    </body>


    <style>

        *, *::before, *::after {
            box-sizing: border-box;
            font-family: 'Courier New', Courier, monospace;
        }

        body {
            margin: 0;
            background-color: #fff;
        }

        img {
            display: block;
            max-width: 100%;
            margin: 0 auto;
        }

        header {
            background-color: #A0B8AE;
            text-transform: uppercase;
            font-weight: 900;
            box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px;
        }

        .container {
            width: 80%;
            max-width: 1100px;
            margin: 0 auto;
        }

        .btn {
            transition: 500ms;
            background-color: #BB9275;
            color: #3f3c3b;
            font-size: large;
            font-weight: 900;
        }

        .btn:hover {
            cursor: pointer;
            background-color: #B7B8B9;
        }

        .credit {
            display: flex;
            justify-content: end;
            align-content: center;
            width: 100%;
            position: fixed;
            bottom: 0;
            background-color: #141414;
        }

        .credit>p {
            padding-right: 1rem;
            color: #fff;
            font-size: 0.7rem;
        }
        
        .credit__img-container {
            width: 5%;
            display: flex;
            align-items: center;
            margin-right: 10%;
        }

        .tag {
            font-weight: 900;
            font-size: 1.3rem;
        }

        .tag-container {
            text-align: center;
            margin: 0 auto 1rem auto;
            color: #fff;
            border: 1px solid black;
            background-color: #718472;
        }

        .no-search-alert {
            margin: 1em auto;
            font-size: 1.2rem;
            font-weight: 900;
        }

        .detail {
            margin: 2rem 0;
            display: none;
        }

        .detail__card {
            width: 100%;
            background-color: #4B4846;
            color: #fff;
            display: flex;
            align-items: center;
        }

        .detail__img-container {
            width: 30%;
            padding: 10em auto;
        }

        .detail__img {
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        .detail__text {
            width: 70%;
            text-align: center;
            font-weight: 900;
            font-size: 1.05rem;
            padding: 1em 2em;
        }

        .bookshelf {
            margin-bottom: 1rem;
        }

        .bookshelf__card {
            background-color: #BB9275 ;
            flex-basis: 15%;
            flex-shrink: 0;
            margin: 1rem 5%;
            transition: 0.3s;
        }

        .bookshelf__card:hover {
            background-color: #718472;
            color: #fff;
            cursor: pointer;
        }

        @media screen and (max-width: 970px) {
            .bookshelf__card {
                flex-basis: 40%;
            }
        }

        .bookshelf__cards-container {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            -ms-overflow-style: -ms-autohiding-scrollbar;
        }

        .more {
            padding-top: 1.5rem;
            padding-bottom: 1rem;
            text-align: center;
            display: none;
        }

        .more__btn {
            padding: 0.25em 2em;
            font-weight: 900;
            border-radius: 24px;
        }

        .result-options {
            display: flex;
            margin-top: 1em;
            justify-content: space-around;
            align-items: center;
            color: #fff;
            border: 1px solid black;
            background-color: #718472;
            padding-right: 1em;
            padding-left: 1em;
        }

        .options-container {
            display: flex;
            align-items: center;
        }

        .option__tag {
            font-size: 1.1rem;
            margin-right: 1em;
        }

        .sort__btn {
            margin: 0;
            color: black!important;
            font-weight: 900;
            font-size: 0.9rem!important;
            padding: 0.25em 2em;
        }

        .display-btn {
            margin: 0;
            color: black!important;
            font-weight: 900;
            font-size: 0.9rem!important;
            padding: 0.25em 2em;
        }

        .results {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .results__card {
            margin-top: 1em;
            margin-bottom: 1em;
            width: 18%;
            flex-shrink: 0;
            background: #A0B8AE;
            box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
            cursor: pointer;
            transition: 500ms;
        }

        @media screen and (max-width: 970px) {
            .results__card {
                width: 30%
            }
            
        }

        .results__card:hover {
            background-color: #718472;
            color: #fff;
        }

        .img-container {
            width: 80%;
            margin: 1em auto;
        }


        .results__text {
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .nav {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            font-size: 1.2rem;
        }

        @media screen and (max-width: 625px) {
            .nav {
                flex-direction: column;
            }

            .results__card {
                width: 45%
            }

            
        }

        @media screen and (max-width: 400px) {
            .results__card {
                width: 90%;
            }
            
        }

        .nav__item {
            padding: 1rem;
            margin: 0.5rem;
            text-decoration: none;
            color: #4B4846;        
        }

        .nav__home {
            border-radius: 24px;
            box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;
        }

        #search__select {
            margin: 0 0.5rem;        
        }

        .search {
            display: flex;
            padding: 0.4em;
            border-radius: 24px;
            box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;
            background-color: white;
        }

        .search__input {
            border: none;
            background-color: transparent;
            outline: none;
            font-size: 1.5rem;
            cursor: text;
        }

        .search__btn {
            cursor: pointer;
            border-radius: 24px;
            padding: 0 1em;
            line-height: 1.6%;

            box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;
        }
        

        
    </style>

    <!-- Mustache.js Template - Search Results card -->
    <script id="result-card-template" type="text/html">
        <article id="{{{id}}}" class="results__card card">
            <div class="img-container">
                <img class="results__img" src="{{{volumeInfo.imageLinks.thumbnail}}}" alt="{{{volumeInfo.title}}} book cover">
            </div>
            <div class="results__text">
                <p>{{volumeInfo.title}}</p>
                <p>{{volumeInfo.categories[0]}}</p>
            </div>
         </article>
    </script>

    <!-- Mustache.js Template - Bookshelf card -->
    <script id="bookshelf-card-template" type="text/html">
        <article id="{{{id}}}" class="bookshelf__card card">
            <div class="img-container">
                <img class="bookshelf__img" src="{{{volumeInfo.imageLinks.thumbnail}}}" alt="">
            </div>
            <div class="results__text">
                <p>{{volumeInfo.title}}</p>
                <p>{{volumeInfo.categories[0]}}</p>
            </div>
        </article>
    </script>

    <!-- Mustache.js Template - Detailed card -->
    <script id="detail-book-template" type="text/html">
        <article class="detail__card">
            <div class="detail__img-container">
                <img class="detail__img" src="{{{volumeInfo.imageLinks.thumbnail}}}" alt=""/>
            </div>
            <div class="detail__text">
                <p>{{volumeInfo.title}}</p>
                <p>{{volumeInfo.subtitle}}</p>
                <p><b>Genres:</b> {{volumeInfo.categories}}</p>
                <p class="detail-book__price"><b>Price: </b>${{saleInfo.retailPrice.amount}}</p>
                <p><b>Description:</b> {{volumeInfo.description}}</p>
            </div>
        </article>
    </script>

    <!-- JQuery / JavaScript -->
    <script>
        $(document).ready(function () {
            var searchIndex;

            // EVENT HANDLERS

            // Book card click event handler. Must be delegated due to templating.
            $(document).on('click', '.card', function() {
                tempDisable(this);
                console.log(this.id);
                $('.detail__card').remove();
                $('.detail').show();
                $("html, body").scrollTop($('.detail').offset().top); // Send user to their selected book details page.
                $.ajax({
                    url: "https://www.googleapis.com/books/v1/volumes/" + this.id,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        // Replace all returned html markup (e.g. <p> with "" for display to user)
                        data.volumeInfo.description = data.volumeInfo.description.replace(/(<([^>]+)>)/ig, "");
                        data.volumeInfo.description = data.volumeInfo.description.replace(/&lt;br&gt;/gm, " ");
                        data.volumeInfo.description = data.volumeInfo.description.replace(/●/gm, " ");

                        $('.detail__container').append(Mustache.render($("#detail-book-template").html(), data));

                        if (data.saleInfo.saleability === "NOT_FOR_SALE"){
                            $(".detail-book__price").html("<b>Price: </b> No price available");
                        }
                    },
                    fail: function () {
                        console.log("Call to API failed.");
                    }
                })
            });

            // Display type button click events
            $('.display-list-btn').click(function () {
                $('.results__card').css('width', '100%');
            });

            $('.display-grid-btn').click(function() {
                $('.results__card').css('width', '18%');
            })

            // Show more button click event
            $('.more__btn').click(function() {
                tempDisable(this);
                console.log(searchIndex);
                searchIndex += 10;
                var searchInput = $('.search__input').val();
                var searchURL = 'https://www.googleapis.com/books/v1/volumes?q=' + searchInput + '&startIndex=' + searchIndex + '&maxResults=10';
                $.ajax({
                    url: searchURL,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        renderSearchResults(data.items);
                    },
                    fail: function (data) {
                        console.log("Request to API failed.");
                    }
                })
                if (searchIndex === 40) {
                    $('.more').hide();
                }
            });


            // Search button click event
            $('.search__btn').click(function() {
                tempDisable(this);
                $('.detail').hide();
                clearBookList();
                $('.more').show();
                searchIndex = 0; // ADJUST FOR PAGINATION
                var searchInput = $('.search__input').val();
                if (!searchInput) {
                     searchInput = 'Test';
                     $('.search__input').val('Test'); 
                    }
                var searchURL = 'https://www.googleapis.com/books/v1/volumes?q=' + searchInput + '&startIndex=0&maxResults=10';
                $.ajax({
                    url: searchURL,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        renderSearchResults(data.items);
                    },
                    fail: function (data) {
                        console.log("Request to API failed.");
                    }
                })
            });

            function renderSearchResults (bookArray) {
                $.each(bookArray, function (index, book) {
                    $('.results').append(Mustache.render($('#result-card-template').html(), book));
                });
            }

            // Append bookshelf array mustache template
            var bookshelf_url = 'https://www.googleapis.com/books/v1/users/109604392818559016458/bookshelves/1001/volumes';
            $.ajax({
               url: bookshelf_url,
               type: "GET",
               dataType: "json",
               success: function (data) {
                console.log(data);
                renderBookshelfArray(data.items);
               } 
            });

            function renderBookshelfArray(bookshelfArray) {
                $.each(bookshelfArray, function(index, bookshelfItem) {
                    $('.bookshelf__cards-container').append(Mustache.render($('#bookshelf-card-template').html(), bookshelfItem));
                });
            }

            // Helper functions

            function clearBookList () {
                $('.results').remove();
                $('.results-container').append("<div class='results'></div>")
            }

            function tempDisable (element) {
                $(element).attr('disabled', 'disabled');
                setTimeout(function () {$(element).removeAttr('disabled');}, 1300);
            }
        })
    </script>
</html>