<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>CM MOVIES</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Mustache -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
        <!-- JQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>
    </head>
    <body>
        <header>
            <div class="container">
                <nav class="nav">
                    <a href="index.html"><img style="width: 6rem;" src="./logo.img.png" alt=""></a>
                    <div class="search">
                        <select name="search__select" id="search__select" class="search__select">
                            <option value="Movies">Movies</option>
                            <option value="Actors">Actors</option>
                        </select>
                        <input class="search__input" type="text">
                        <button class="search__btn btn">></button>
                    </div>
                    <p id="web-author-name" class="nav__item">Cameron McElwaney</p>
                </nav>
            </div>
        </header>
        <main>
            <div class="container results-container">
                <div class="result-options">
                    <div class="display options-container">
                        <p class="option__tag tag">Display: </p>
                        <button class="display-btn display-grid-btn btn">GRID</button>
                        <button class="display-btn display-list-btn btn">LIST</button>
                    </div>
                </div>
                <div class="results">
                    <p class="no-search-alert">NO SEARCH PERFORMED</p>
                    <!-- Generated by mustache.js template on search button press -->
                </div>
            </div>
            <div class="more">
                <button class="more__btn btn">SHOW MORE</button>
            </div>  
        </main>
        <section class="detail">
            <div class="container detail__container">
                <div class="tag-container">
                    <p class="tag">DETAILS</p>
                </div>
                <!-- Generated using Mustache.js detail card template -->
            </div>
        </section>
        <footer>
            <div class="container">
                <div class="pop-movies">
                    <div class="tag-container">
                        <p class="tag">POPULAR MOVIES</p>
                    </div>
                    <div class="pop-movie__cards-container">
                        <!-- Generated via mustache template -->
                    </div>
                </div>
            </div>
            <div class="credit credit-container">
                <p>This product uses the TMDB API but is not endorsed or certified by TMDB.</p>
                <div class="credit__img-container">
                    <img src="tmdb_credit.svg" alt="">
                </div>
            </div>
            
        </footer>

    </body>


    <style>

        *, *::before, *::after {
            box-sizing: border-box;
            font-family: 'Courier New', Courier, monospace;
        }

        body {
            margin: 0;
            background-color: #191918;
        }

        img {
            display: block;
            max-width: 100%;
            margin: 0 auto;
        }

        header {
            background-color: #718472;
            text-transform: uppercase;
            font-weight: 900;
            box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px;
        }

        .container {
            width: 80%;
            max-width: 1100px;
            margin: 0 auto;
        }

        .btn {
            transition: 500ms;
            background-color: #BB9275;
            color: #3f3c3b;
            font-size: 1rem;
            font-weight: 900;
        }

        .btn:hover {
            cursor: pointer;
            background-color: #B7B8B9;
        }

        .credit {
            display: flex;
            justify-content: end;
            align-content: center;
            width: 100%;
            position: fixed;
            bottom: 0;
            background-color: #141414;
        }

        .no-search-alert {
            color: #fff;
        }

        .credit>p {
            padding-right: 1rem;
            color: #fff;
            font-size: 0.7rem;
        }
        
        .credit__img-container {
            width: 5%;
            display: flex;
            align-items: center;
            margin-right: 10%;
        }

        .tag {
            font-weight: 900;
            font-size: 1.1rem;
        }

        .tag-container {
            text-align: center;
            margin: 0 auto 1rem auto;
            color: #fff;
            border: 1px solid black;
            background-color: #718472;
        }

        .no-search-alert {
            margin: 1em auto;
            font-size: 1.2rem;
            font-weight: 900;
        }

        .detail {
            margin: 2rem 0;
            display: none;
        }

        .detail__card {
            width: 100%;
            background-color: #4B4846;
            color: #fff;
            display: flex;
            align-items: center;
        }

        .detail__img-container {
            width: 30%;
            padding: 10em auto;
            margin-left: 1rem;
        }

        .detail__img {
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        .detail__text {
            width: 70%;
            text-align: center;
            font-weight: 900;
            font-size: 1rem;
            padding: 1em 2em;
        }

        .pop-movies {
            margin-bottom: 1rem;
        }

        .pop-movie__card {
            background-color: #718472 ;
            flex-basis: 15%;
            flex-shrink: 0;
            margin: 1rem 5%;
            transition: 0.3s;
        }

        .pop-movie__card:hover {
            background-color: #718472;
            color: #fff;
            cursor: pointer;
        }

        .pop-movie__cards-container {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            -ms-overflow-style: -ms-autohiding-scrollbar;
        }

        .more {
            padding-top: 1.5rem;
            padding-bottom: 1rem;
            text-align: center;
            display: none;
        }

        .more__btn {
            padding: 0.25em 2em;
            font-weight: 900;
            border-radius: 24px;
        }

        .result-options {
            display: flex;
            margin-top: 1em;
            justify-content: space-around;
            align-items: center;
            color: #fff;
            border: 1px solid black;
            background-color: #718472;
            padding-right: 1em;
            padding-left: 1em;
        }

        .options-container {
            display: flex;
            align-items: center;
        }

        .option__tag {
            margin-right: 1em;
        }

        .sort__btn {
            margin: 0;
            color: black!important;
            font-weight: 900;
            padding: 0.25em 2em;
        }

        .display-btn {
            margin: 0;
            color: black!important;
            font-weight: 900;
            padding: 0.25em 2em;
        }

        .results {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .results__card {
            margin-top: 1em;
            margin-bottom: 1em;
            width: 18%;
            flex-shrink: 0;
            background: #A0B8AE;
            box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
            cursor: pointer;
            transition: 500ms;
        }

        .result__name {
            text-transform: uppercase;
        }

        .results__card:hover {
            background-color: #718472;
            color: #fff;
        }

        .img-container {
            width: 80%;
            margin: 1em auto;
        }

        .list-img-container {
            width: 20%;
        }


        .results__text {
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .nav {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            font-size: 1.2rem;
        }

        .nav__item {
            padding: 1rem;
            margin: 0.5rem;
            text-decoration: none;
            color: #4B4846;        
        }

        .nav__home {
            border-radius: 24px;
            box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;
        }

        #search__select {
            margin: 0 0.5rem;
            border-right: 1px solid black;
            border-left: none;
            border-bottom: none;
            border-top: none;
               
        }

        .search {
            display: flex;
            padding: 0.4em;
            border-radius: 24px;
            box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;
            background-color: white;
        }

        .search__input {
            border: none;
            background-color: transparent;
            outline: none;
            font-size: 1.2rem;
            cursor: text;
        }

        .search__btn {
            cursor: pointer;
            border-radius: 24px;
            padding: 0 1em;
            line-height: 1.6%;

            box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;
        }

        @media screen and (max-width: 970px) {
            .pop-movie__card {
                flex-basis: 40%;
            }

            .detail__card {
                flex-direction: column;
            }

            .detail__img-container {
                width: 60%;
            }

            #web-author-name {
                display: none;
            }

            .results__card {
                width: 30%
            }

            .no-search-alert {                
                font-size: 0.8rem;
            }

            .tag {
                font-size: 0.8rem;
            }

            .btn {
                font-size: 0.5rem;
            }

            .sort__btn, .display-btn {
                padding: 0.2rem;
            }

            .search__input {
                font-size: 0.8rem;
            }
        }

        @media screen and (max-width: 625px) {

            .nav {
                flex-direction: column;
                padding-bottom: 1rem;
            }

            .results__card {
                width: 45%
            }

            .list-img-container {
                width: 60%;
            }

            .tag {
                font-size: 0.5rem;
            }


        }

            @media screen and (max-width: 400px) {
            .card {
                flex-basis: 90%;
            }

        }
        

        
    </style>

    <!-- Mustache.js Template - Search Results card -->
    <script id="result-card-template" type="text/html">
        <article id="{{{id}}}" class="results__card card">
            <div class="img-container results__img-container">
                <img class="results__img" src="{{{img}}}" alt="{{{img}}}">
            </div>
            <div class="results__text">
                <p class="result__name">{{title}}</p>
            </div>
         </article>
    </script>

    <!-- Mustache.js Template - Popular Movie card -->
    <script id="popMovie-card-template" type="text/html">
        <article id="{{{id}}}" class="pop-movie__card card">
            <div class="img-container">
                <img class="popMovie__img" src="{{{img}}}" alt="{{{title}}} movie img">
            </div>
            <div class="results__text">
                <p>{{title}}</p>
            </div>
        </article>
    </script>

    <!-- Mustache.js Template - Detailed movie card -->
    <script id="detail-movie-template" type="text/html">
        <article class="detail__card">
            <div class="detail__img-container">
                <img class="detail__img" src="{{{img}}}" alt="{{{title}}} poster photo"/>
            </div>
            <div class="detail__text">
                <p>{{title}}</p>
                <p><b>Genre:</b> {{genre1}}</p>
                <p><b>Description:</b> {{overview}}</p>
            </div>
        </article>
    </script>

    <!-- Mustache.js Template - Detailed actor card -->
    <script id="detail-actor-template" type="text/html">
        <article class="detail__card">
            <div class="detail__img-container">
                <img class="detail__img" src="{{{img}}}" alt="{{{name}}} profile photo"/>
            </div>
            <div class="detail__text">
                <p>{{name}}</p>
                <p><b>Birthday:</b> {{birthday}}</p>
                <p><b>Birthplace:</b> {{place_of_birth}}</p>
                <p><b>Biography:</b> {{biography}}</p>
            </div>
        </article>
    </script>

    <!-- JQuery / JavaScript -->
    <script>
        $(document).ready(function () {
            var searchIndex;

            // EVENT HANDLERS

            // Clear search results on select option change to prevent ID mismatch of persons to movies.
            $('.search__select').change(function() {
                clearSearchList();
                $('.more').hide();
                $('.detail').hide();
                $('.results').append('<p class="no-search-alert">NO SEARCH PERFORMED</p>');
            });

            // Book card click event handler. Must be delegated due to templating.
            $(document).on('click', '.card', function() {
                tempDisable(this);
                console.log(this.id);
                $('.detail__card').remove();
                $('.detail').show();
                $("html, body").scrollTop($('.detail').offset().top); // Send user to their selected book details page.
                if ($('#search__select').val() === 'Movies' || $(this).hasClass('pop-movie__card')) {
                    $.ajax({
                        url: 'https://api.themoviedb.org/3/movie/' + this.id + '?api_key=0266a67ac14ac71f091e39db4e90b0e0&language=en-US',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            console.log(data);
                            data.genre1 = data.genres[0].name;
                            data.img = "https://image.tmdb.org/t/p/w500" + data.poster_path;
                            $('.detail__container').append(Mustache.render($("#detail-movie-template").html(), data));
                        },
                        fail: function () {
                            console.log("Call to API failed.");
                        }
                    })
                }
                else if ($('#search__select').val() === 'Actors') {
                    $.ajax({
                        url: 'https://api.themoviedb.org/3/person/' + this.id + '?api_key=0266a67ac14ac71f091e39db4e90b0e0&language=en-US',
                        type: "GET",
                        dataType: "json",
                        success: function (data) {
                            console.log(data);
                            data.img = "https://image.tmdb.org/t/p/w500" + data.profile_path;

                            if (data.biography === "") {
                                data.biography = "No biography listed.";
                            }
                            $('.detail__container').append(Mustache.render($("#detail-actor-template").html(), data));
                        },
                        fail: function () {
                            console.log("Call to API failed.");
                        }
                    })
                }
            });

            // Display type button click events
            $('.display-list-btn').click(function () {
                $('.results__card').css('width', '100%');
                $('.results__img-container').addClass('list-img-container');
            });

            $('.display-grid-btn').click(function() {
                $('.results__card').css('width', '18%');
                $('.results__img-container').removeClass('list-img-container');
                // reset image size
            })

            // Show more button click event
            $('.more__btn').click(function() {
                tempDisable(this);
                console.log(searchIndex);
                var searchInput = $('.search__input').val();
                if ($('#search__select').val() === 'Movies'){
                    searchIndex++;
                var searchURL = 'https://api.themoviedb.org/3/search/movie?api_key=0266a67ac14ac71f091e39db4e90b0e0&language=en-US&page=' + searchIndex + '&query=' + searchInput;
                $.ajax({
                    url: searchURL,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        renderMovieSearchResults(data.results);
                    },
                    fail: function (data) {
                        console.log("Request to API failed.");
                    }
                })
                if (searchIndex === 3) {
                    $('.more').hide();
                }
            }
            else {
                searchIndex++;
                var searchURL = 'https://api.themoviedb.org/3/search/person?api_key=0266a67ac14ac71f091e39db4e90b0e0&language=en-US&page=' + searchIndex + '&include_adult=false&query=' + searchInput;
                $.ajax({
                    url: searchURL,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        renderPersonSearchResults(data.results);
                    },
                    fail: function (data) {
                        console.log("Request to API failed.");
                    }
                });
            }
        });


            // Search button click event
            $('.search__btn').click(function() {
                tempDisable(this);
                $('.detail').hide();
                clearSearchList();
                $('.more').show();
                var searchInput = $('.search__input').val();
                if (!searchInput) {
                     searchInput = 'Test';
                     $('.search__input').val('Test'); 
                    }
                if ($('#search__select').val() === 'Movies'){
                    searchIndex = 1; // ADJUST FOR PAGINATION
                var searchURL = 'https://api.themoviedb.org/3/search/movie?api_key=0266a67ac14ac71f091e39db4e90b0e0&language=en-US&page=1&query=' + searchInput;
                $.ajax({
                    url: searchURL,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        renderMovieSearchResults(data.results);
                    },
                    fail: function (data) {
                        console.log("Request to API failed.");
                    }
                })
            }
            else if ($('#search__select').val() === 'Actors'){
                    searchIndex = 1; // ADJUST FOR PAGINATION
                var searchURL = 'https://api.themoviedb.org/3/search/person?api_key=0266a67ac14ac71f091e39db4e90b0e0&language=en-US&page=1&include_adult=false&query=' + searchInput;
                $.ajax({
                    url: searchURL,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        renderPersonSearchResults(data.results);
                    },
                    fail: function (data) {
                        console.log("Request to API failed.");
                    }
                })
            }
            });

            function renderPersonSearchResults (personArray) {
                $.each(personArray, function (index, person) {
                    if (person.profile_path === null) {
                        person.img = 'no-poster-img.png';
                    }
                    else {
                        person.img = 'https://image.tmdb.org/t/p/w500' + person.profile_path;
                    }

                    person.title = person.name;

                    $('.results').append(Mustache.render($('#result-card-template').html(), person));
                })
            }

            function renderMovieSearchResults (movieArray) {
                $.each(movieArray, function (index, movie) {
                    if (movie.poster_path === null) {
                        movie.img = 'no-poster-img.png';
                    }
                    else {
                        movie.img = "https://image.tmdb.org/t/p/w500" + movie.poster_path;
                    }
                        $('.results').append(Mustache.render($('#result-card-template').html(), movie));
                });
            }

            // Append popular movie array mustache template
            var popularMovies_url = 'https://api.themoviedb.org/3/movie/popular?api_key=0266a67ac14ac71f091e39db4e90b0e0&language=en-US&page=1';
            $.ajax({
               url: popularMovies_url,
               type: "GET",
               dataType: "json",
               success: function (data) {
                console.log(data);
                renderPopMoviesArray(data.results);
               } 
            });

            function renderPopMoviesArray(popMovieArray) {
                $.each(popMovieArray, function(index, popMovieItem) {
                    if (popMovieItem.poster_path === null) {
                        popMovieItem.img = '/no-poster-img.png';
                    }
                    else {
                        popMovieItem.img = 'https://image.tmdb.org/t/p/w500' + popMovieItem.poster_path;
                    }
                    $('.pop-movie__cards-container').append(Mustache.render($('#popMovie-card-template').html(), popMovieItem));
                });
            }

            // Helper functions

            function clearSearchList () {
                $('.results').remove();
                $('.results-container').append("<div class='results'></div>")
            }

            function tempDisable (element) {
                $(element).attr('disabled', 'disabled');
                setTimeout(function () {$(element).removeAttr('disabled');}, 1300);
            }
        });
    </script>
</html>